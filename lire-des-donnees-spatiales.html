<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 4 Lire et écrire des données spatiales avec R | Analyses spatiales avec R</title>
  <meta name="description" content="Support de cours du module 7 « Analyse spatiale » de la valise pédagogique Parcours-r MTES/MCTRCT" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 4 Lire et écrire des données spatiales avec R | Analyses spatiales avec R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Support de cours du module 7 « Analyse spatiale » de la valise pédagogique Parcours-r MTES/MCTRCT" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 4 Lire et écrire des données spatiales avec R | Analyses spatiales avec R" />
  
  <meta name="twitter:description" content="Support de cours du module 7 « Analyse spatiale » de la valise pédagogique Parcours-r MTES/MCTRCT" />
  

<meta name="author" content="Maël THEULIERE, Jean-Daniel LOMENEDE, Juliette ENGELAERE-LEFEBVRE" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="crs.html"/>
<link rel="next" href="operation-sur-donnees-attributaires.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/d3-bundle-5.16.0/d3-bundle.min.js"></script>
<script src="libs/d3-lasso-0.0.5/d3-lasso.min.js"></script>
<script src="libs/save-svg-as-png-1.4.17/save-svg-as-png.min.js"></script>
<script src="libs/flatbush-4.4.0/flatbush.min.js"></script>
<link href="libs/ggiraphjs-0.8.10/ggiraphjs.min.css" rel="stylesheet" />
<script src="libs/ggiraphjs-0.8.10/ggiraphjs.min.js"></script>
<script src="libs/girafe-binding-0.8.10/girafe.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><p style="text-align:center;"><img src="https://mtes-mct.github.io/parcours-r/assets/images/logo_marianne_fond_blanc.png" style="width:100px;"/></p></li>
<li><a href="./index.html">Les données spatiales avec R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#le-parcours-de-formation"><i class="fa fa-check"></i>Le parcours de formation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#le-groupe-de-référents-r-du-pôle-ministériel"><i class="fa fa-check"></i>Le groupe de référents R du pôle ministériel</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#objectifs-de-ce-module"><i class="fa fa-check"></i>Objectifs de ce module</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="get-started.html"><a href="get-started.html"><i class="fa fa-check"></i><b>1</b> Bien commencer</a>
<ul>
<li class="chapter" data-level="1.1" data-path="get-started.html"><a href="get-started.html#créer-un-projet-sous-rstudio-pour-vous-permettre-de-recenser-vos-travaux."><i class="fa fa-check"></i><b>1.1</b> Créer un projet sous Rstudio pour vous permettre de recenser vos travaux.</a></li>
<li class="chapter" data-level="1.2" data-path="get-started.html"><a href="get-started.html#utilisation-du-package-savoirfr"><i class="fa fa-check"></i><b>1.2</b> Utilisation du package <code>{savoirfR}</code></a></li>
<li class="chapter" data-level="1.3" data-path="get-started.html"><a href="get-started.html#créer-votre-arborescence-de-projet"><i class="fa fa-check"></i><b>1.3</b> Créer votre arborescence de projet</a></li>
<li class="chapter" data-level="1.4" data-path="get-started.html"><a href="get-started.html#activer-les-packages-nécessaires"><i class="fa fa-check"></i><b>1.4</b> Activer les packages nécessaires</a></li>
<li class="chapter" data-level="1.5" data-path="get-started.html"><a href="get-started.html#bien-structurer-ses-projets-data"><i class="fa fa-check"></i><b>1.5</b> Bien structurer ses projets data</a></li>
</ul></li>
<li class="part"><span><b>I Introduction aux données spatiales</b></span></li>
<li class="chapter" data-level="2" data-path="modelisation.html"><a href="modelisation.html"><i class="fa fa-check"></i><b>2</b> La modélisation des données spatiales</a>
<ul>
<li class="chapter" data-level="2.1" data-path="modelisation.html"><a href="modelisation.html#les-données-vecteur"><i class="fa fa-check"></i><b>2.1</b> Les données vecteur</a></li>
<li class="chapter" data-level="2.2" data-path="modelisation.html"><a href="modelisation.html#les-données-raster"><i class="fa fa-check"></i><b>2.2</b> Les données raster</a></li>
<li class="chapter" data-level="2.3" data-path="modelisation.html"><a href="modelisation.html#la-structuration-des-données-géographiques-avec-r"><i class="fa fa-check"></i><b>2.3</b> La structuration des données géographiques avec R</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="modelisation.html"><a href="modelisation.html#sf-pour-les-données-vecteur"><i class="fa fa-check"></i><b>2.3.1</b> <code>{sf}</code> pour les données vecteur</a></li>
<li class="chapter" data-level="2.3.2" data-path="modelisation.html"><a href="modelisation.html#terra-raster-et-stars-pour-les-données-raster"><i class="fa fa-check"></i><b>2.3.2</b> {terra}, {raster} et {stars} pour les données raster</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="modelisation.html"><a href="modelisation.html#format-des-objets-spatiaux-sf"><i class="fa fa-check"></i><b>2.4</b> Format des objets spatiaux <code>sf</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="crs.html"><a href="crs.html"><i class="fa fa-check"></i><b>3</b> Les Systèmes de Coordonnées de Référence</a>
<ul>
<li class="chapter" data-level="3.1" data-path="crs.html"><a href="crs.html#le-système-géodésique-ou-datum"><i class="fa fa-check"></i><b>3.1</b> Le système géodésique ou datum</a></li>
<li class="chapter" data-level="3.2" data-path="crs.html"><a href="crs.html#les-coordonnées"><i class="fa fa-check"></i><b>3.2</b> Les coordonnées</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="crs.html"><a href="crs.html#coordonnées-géographiques"><i class="fa fa-check"></i><b>3.2.1</b> Coordonnées géographiques</a></li>
<li class="chapter" data-level="3.2.2" data-path="crs.html"><a href="crs.html#coordonnées-en-projection"><i class="fa fa-check"></i><b>3.2.2</b> Coordonnées en projection</a></li>
<li class="chapter" data-level="3.2.3" data-path="crs.html"><a href="crs.html#exemple-de-projections"><i class="fa fa-check"></i><b>3.2.3</b> Exemple de projections</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="crs.html"><a href="crs.html#code-epsg"><i class="fa fa-check"></i><b>3.3</b> Code EPSG</a></li>
</ul></li>
<li class="part"><span><b>II Lire et écrire des données spatiales</b></span></li>
<li class="chapter" data-level="4" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html"><i class="fa fa-check"></i><b>4</b> Lire et écrire des données spatiales avec R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#lire-des-fichiers-plats"><i class="fa fa-check"></i><b>4.1</b> Lire des fichiers plats</a></li>
<li class="chapter" data-level="4.2" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#ecrire-des-fichiers-plats"><i class="fa fa-check"></i><b>4.2</b> Ecrire des fichiers plats</a></li>
<li class="chapter" data-level="4.3" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#lire-des-données-spatiales-du-web"><i class="fa fa-check"></i><b>4.3</b> Lire des données spatiales du web</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#lire-des-données-geojson"><i class="fa fa-check"></i><b>4.3.1</b> Lire des données geojson</a></li>
<li class="chapter" data-level="4.3.2" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#exemple-3-geojson-compressé"><i class="fa fa-check"></i><b>4.3.2</b> Exemple 3 (geojson compressé)</a></li>
<li class="chapter" data-level="4.3.3" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#lire-des-données-wfs"><i class="fa fa-check"></i><b>4.3.3</b> Lire des données WFS</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#lireécrire-des-données-spatiales-sur-postgis"><i class="fa fa-check"></i><b>4.4</b> Lire/écrire des données spatiales sur PostGIS</a></li>
<li class="chapter" data-level="4.5" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#convertir-un-dataframe"><i class="fa fa-check"></i><b>4.5</b> Convertir un dataframe</a></li>
<li class="chapter" data-level="4.6" data-path="lire-des-donnees-spatiales.html"><a href="lire-des-donnees-spatiales.html#données-contenues-dans-des-packages"><i class="fa fa-check"></i><b>4.6</b> Données contenues dans des packages</a></li>
</ul></li>
<li class="part"><span><b>III Manipuler des données spatiales</b></span></li>
<li class="chapter" data-level="5" data-path="operation-sur-donnees-attributaires.html"><a href="operation-sur-donnees-attributaires.html"><i class="fa fa-check"></i><b>5</b> Les opérations sur données attributaires</a></li>
<li class="chapter" data-level="6" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html"><i class="fa fa-check"></i><b>6</b> Les opérations spatiales sur les données</a>
<ul>
<li class="chapter" data-level="6.1" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#filtrer"><i class="fa fa-check"></i><b>6.1</b> Filtrer</a></li>
<li class="chapter" data-level="6.2" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#prédicats-spatiaux"><i class="fa fa-check"></i><b>6.2</b> Prédicats spatiaux</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#exercice-1---manipuler-des-objets-sf"><i class="fa fa-check"></i><b>6.2.1</b> Exercice 1 - manipuler des objets sf</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#les-jointures-spatiales"><i class="fa fa-check"></i><b>6.3</b> Les jointures spatiales</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#jointure-de-points-avec-des-polygones"><i class="fa fa-check"></i><b>6.3.1</b> Jointure de points avec des polygones</a></li>
<li class="chapter" data-level="6.3.2" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#jointure-de-polygones-avec-des-polygones"><i class="fa fa-check"></i><b>6.3.2</b> Jointure de polygones avec des polygones</a></li>
<li class="chapter" data-level="6.3.3" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#exercice-2-exploitation-des-données-dvf-en-api"><i class="fa fa-check"></i><b>6.3.3</b> Exercice 2 : exploitation des données DVF en API</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#les-mesures"><i class="fa fa-check"></i><b>6.4</b> Les mesures</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#calcul-de-surface"><i class="fa fa-check"></i><b>6.4.1</b> Calcul de surface</a></li>
<li class="chapter" data-level="6.4.2" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#matrice-de-distances"><i class="fa fa-check"></i><b>6.4.2</b> Matrice de distances</a></li>
<li class="chapter" data-level="6.4.3" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#identification-du-plus-proche-voisin"><i class="fa fa-check"></i><b>6.4.3</b> Identification du plus proche voisin</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#carroyage"><i class="fa fa-check"></i><b>6.5</b> Carroyage</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#créer-une-grille-régulière"><i class="fa fa-check"></i><b>6.5.1</b> Créer une grille régulière</a></li>
<li class="chapter" data-level="6.5.2" data-path="les-operations-sur-donnees-spatiales.html"><a href="les-operations-sur-donnees-spatiales.html#compter-des-points-dans-un-polygone"><i class="fa fa-check"></i><b>6.5.2</b> Compter des points dans un polygone</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="operations-geometriques.html"><a href="operations-geometriques.html"><i class="fa fa-check"></i><b>7</b> Les opérations géométriques</a>
<ul>
<li class="chapter" data-level="7.1" data-path="operations-geometriques.html"><a href="operations-geometriques.html#opérations-unaires"><i class="fa fa-check"></i><b>7.1</b> Opérations unaires</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="operations-geometriques.html"><a href="operations-geometriques.html#simplification"><i class="fa fa-check"></i><b>7.1.1</b> Simplification</a></li>
<li class="chapter" data-level="7.1.2" data-path="operations-geometriques.html"><a href="operations-geometriques.html#centroïde"><i class="fa fa-check"></i><b>7.1.2</b> Centroïde</a></li>
<li class="chapter" data-level="7.1.3" data-path="operations-geometriques.html"><a href="operations-geometriques.html#buffer"><i class="fa fa-check"></i><b>7.1.3</b> Buffer</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="operations-geometriques.html"><a href="operations-geometriques.html#opérations-binaires"><i class="fa fa-check"></i><b>7.2</b> Opérations binaires</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="operations-geometriques.html"><a href="operations-geometriques.html#transformation-affine"><i class="fa fa-check"></i><b>7.2.1</b> Transformation affine</a></li>
<li class="chapter" data-level="7.2.2" data-path="operations-geometriques.html"><a href="operations-geometriques.html#découpage"><i class="fa fa-check"></i><b>7.2.2</b> Découpage</a></li>
<li class="chapter" data-level="7.2.3" data-path="operations-geometriques.html"><a href="operations-geometriques.html#union"><i class="fa fa-check"></i><b>7.2.3</b> Union</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="les-reprojections.html"><a href="les-reprojections.html"><i class="fa fa-check"></i><b>8</b> Les reprojections</a>
<ul>
<li class="chapter" data-level="8.1" data-path="les-reprojections.html"><a href="les-reprojections.html#un-premier-exemple-de-reprojection"><i class="fa fa-check"></i><b>8.1</b> Un premier exemple de reprojection</a></li>
<li class="chapter" data-level="8.2" data-path="les-reprojections.html"><a href="les-reprojections.html#quand-reprojeter"><i class="fa fa-check"></i><b>8.2</b> Quand reprojeter ?</a></li>
<li class="chapter" data-level="8.3" data-path="les-reprojections.html"><a href="les-reprojections.html#quel-crs-utiliser"><i class="fa fa-check"></i><b>8.3</b> Quel CRS utiliser ?</a></li>
<li class="chapter" data-level="8.4" data-path="les-reprojections.html"><a href="les-reprojections.html#comment-projeter"><i class="fa fa-check"></i><b>8.4</b> Comment projeter ?</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="les-reprojections.html"><a href="les-reprojections.html#projeter-des-vecteurs"><i class="fa fa-check"></i><b>8.4.1</b> Projeter des vecteurs</a></li>
<li class="chapter" data-level="8.4.2" data-path="les-reprojections.html"><a href="les-reprojections.html#modifier-la-projection-dune-carte."><i class="fa fa-check"></i><b>8.4.2</b> Modifier la projection d’une carte.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="geocodage.html"><a href="geocodage.html"><i class="fa fa-check"></i><b>9</b> Géocodage</a>
<ul>
<li class="chapter" data-level="9.1" data-path="geocodage.html"><a href="geocodage.html#géolocalisation-à-ladresse"><i class="fa fa-check"></i><b>9.1</b> Géolocalisation à l’adresse</a></li>
<li class="chapter" data-level="9.2" data-path="geocodage.html"><a href="geocodage.html#digitalisation"><i class="fa fa-check"></i><b>9.2</b> Digitalisation</a></li>
</ul></li>
<li class="part"><span><b>IV Créer des cartes sous R</b></span></li>
<li class="chapter" data-level="10" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html"><i class="fa fa-check"></i><b>10</b> Créer des cartes statiques avec {ggplot2}</a>
<ul>
<li class="chapter" data-level="10.1" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#librairies"><i class="fa fa-check"></i><b>10.1</b> Librairies</a></li>
<li class="chapter" data-level="10.2" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#introduction-les-cartes-statiques-en-r"><i class="fa fa-check"></i><b>10.2</b> Introduction : les cartes statiques en R</a></li>
<li class="chapter" data-level="10.3" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#quelques-rappels-sur-ggplot2"><i class="fa fa-check"></i><b>10.3</b> Quelques rappels sur <code>{ggplot2}</code></a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#ggplot2-les-concepts-clefs"><i class="fa fa-check"></i><b>10.3.1</b> <code>{ggplot2}</code> : les concepts clefs</a></li>
<li class="chapter" data-level="10.3.2" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#ggplot2-pour-les-cartes"><i class="fa fa-check"></i><b>10.3.2</b> {ggplot2} pour les cartes</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#faire-des-cartes-avec-ggplot2"><i class="fa fa-check"></i><b>10.4</b> Faire des cartes avec {ggplot2}</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#préparation-des-données"><i class="fa fa-check"></i><b>10.4.1</b> Préparation des données</a></li>
<li class="chapter" data-level="10.4.2" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#les-cartes-choroplèthe"><i class="fa fa-check"></i><b>10.4.2</b> Les cartes choroplèthe</a></li>
<li class="chapter" data-level="10.4.3" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#les-cartes-à-ronds-proportionnels"><i class="fa fa-check"></i><b>10.4.3</b> Les cartes à ronds proportionnels</a></li>
<li class="chapter" data-level="10.4.4" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#lhabillage-simple"><i class="fa fa-check"></i><b>10.4.4</b> L’habillage simple</a></li>
<li class="chapter" data-level="10.4.5" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#les-thèmes"><i class="fa fa-check"></i><b>10.4.5</b> Les thèmes</a></li>
<li class="chapter" data-level="10.4.6" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#les-scales"><i class="fa fa-check"></i><b>10.4.6</b> Les scales</a></li>
<li class="chapter" data-level="10.4.7" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#exercice-3---carte-des-données-dvf-par-quartie-de-nantes"><i class="fa fa-check"></i><b>10.4.7</b> Exercice 3 - Carte des données dvf par quartie de Nantes</a></li>
<li class="chapter" data-level="10.4.8" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#les-facettes"><i class="fa fa-check"></i><b>10.4.8</b> Les facettes</a></li>
<li class="chapter" data-level="10.4.9" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#ajouter-une-barre-déchelle-et-la-flèche-du-nord"><i class="fa fa-check"></i><b>10.4.9</b> Ajouter une barre d’échelle et la flèche du nord</a></li>
<li class="chapter" data-level="10.4.10" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#mettre-plusieurs-cartes-côte-à-côte"><i class="fa fa-check"></i><b>10.4.10</b> Mettre plusieurs cartes côte à côte</a></li>
<li class="chapter" data-level="10.4.11" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#exporter-sa-carte"><i class="fa fa-check"></i><b>10.4.11</b> Exporter sa carte</a></li>
<li class="chapter" data-level="10.4.12" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#exercice-4-assemblage-de-cartes-sur-dvf"><i class="fa fa-check"></i><b>10.4.12</b> Exercice 4 : Assemblage de cartes sur dvf</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="creer-des-cartes-avec-ggplot2.html"><a href="creer-des-cartes-avec-ggplot2.html#faire-des-cartes-avec-mapfactory"><i class="fa fa-check"></i><b>10.5</b> Faire des cartes avec {mapfactory}</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="cartogramm.html"><a href="cartogramm.html"><i class="fa fa-check"></i><b>11</b> Créer des cartogrammes</a>
<ul>
<li class="chapter" data-level="11.1" data-path="cartogramm.html"><a href="cartogramm.html#cartogramme-daires-contigues"><i class="fa fa-check"></i><b>11.1</b> Cartogramme d’aires contigues</a></li>
<li class="chapter" data-level="11.2" data-path="cartogramm.html"><a href="cartogramm.html#cartogramme-daire-non-contigue"><i class="fa fa-check"></i><b>11.2</b> Cartogramme d’aire non contigue</a></li>
<li class="chapter" data-level="11.3" data-path="cartogramm.html"><a href="cartogramm.html#cartogramme-de-dorling"><i class="fa fa-check"></i><b>11.3</b> Cartogramme de Dorling</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html"><i class="fa fa-check"></i><b>12</b> Créer des cartes pour le web</a>
<ul>
<li class="chapter" data-level="12.1" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#les-cartes-leaflet"><i class="fa fa-check"></i><b>12.1</b> Les cartes Leaflet</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#carte-choroplète"><i class="fa fa-check"></i><b>12.1.1</b> Carte choroplète</a></li>
<li class="chapter" data-level="12.1.2" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#carte-à-ronds-proportionnels"><i class="fa fa-check"></i><b>12.1.2</b> Carte à ronds proportionnels</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#les-cartes-ggplot"><i class="fa fa-check"></i><b>12.2</b> Les cartes ggplot</a></li>
<li class="chapter" data-level="12.3" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#les-cartes-mapfactory"><i class="fa fa-check"></i><b>12.3</b> Les cartes {mapfactory}</a></li>
<li class="chapter" data-level="12.4" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#exporter-une-sortie-html"><i class="fa fa-check"></i><b>12.4</b> Exporter une sortie html</a></li>
<li class="chapter" data-level="12.5" data-path="creer-des-cartes-pour-le-web.html"><a href="creer-des-cartes-pour-le-web.html#exercice-5-cartes-dvf-pour-le-web"><i class="fa fa-check"></i><b>12.5</b> Exercice 5 : cartes DVF pour le web</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="osm.html"><a href="osm.html"><i class="fa fa-check"></i><b>13</b> Focus sur OpenStreetMap</a>
<ul>
<li class="chapter" data-level="13.1" data-path="osm.html"><a href="osm.html#afficher-une-carte-interactive"><i class="fa fa-check"></i><b>13.1</b> Afficher une carte interactive</a></li>
<li class="chapter" data-level="13.2" data-path="osm.html"><a href="osm.html#importer-les-fonds-de-carte-pour-ggplot"><i class="fa fa-check"></i><b>13.2</b> Importer les fonds de carte pour ggplot</a></li>
<li class="chapter" data-level="13.3" data-path="osm.html"><a href="osm.html#importer-des-données-osm"><i class="fa fa-check"></i><b>13.3</b> Importer des données OSM</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="osm.html"><a href="osm.html#osmdata"><i class="fa fa-check"></i><b>13.3.1</b> <code>{osmdata}</code></a></li>
<li class="chapter" data-level="13.3.2" data-path="osm.html"><a href="osm.html#osmextract"><i class="fa fa-check"></i><b>13.3.2</b> <code>osmextract</code></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="osm.html"><a href="osm.html#calculer-des-itinéraires"><i class="fa fa-check"></i><b>13.4</b> Calculer des itinéraires</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="osm.html"><a href="osm.html#calcul-dun-itinéraire"><i class="fa fa-check"></i><b>13.4.1</b> Calcul d’un itinéraire</a></li>
<li class="chapter" data-level="13.4.2" data-path="osm.html"><a href="osm.html#calcul-dune-matrice-de-temps"><i class="fa fa-check"></i><b>13.4.2</b> Calcul d’une matrice de temps</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V A propos</b></span></li>
<li class="chapter" data-level="14" data-path="a-propos.html"><a href="a-propos.html"><i class="fa fa-check"></i><b>14</b> A propos de ce document</a>
<ul>
<li class="chapter" data-level="" data-path="a-propos.html"><a href="a-propos.html#code-source"><i class="fa fa-check"></i>Code source</a></li>
<li class="chapter" data-level="" data-path="a-propos.html"><a href="a-propos.html#inspiration"><i class="fa fa-check"></i>Inspiration</a></li>
<li class="chapter" data-level="" data-path="a-propos.html"><a href="a-propos.html#licence"><i class="fa fa-check"></i>Licence</a></li>
<li class="chapter" data-level="" data-path="a-propos.html"><a href="a-propos.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html"><i class="fa fa-check"></i><b>15</b> Annexe : créer des cartes avec tmap</a>
<ul>
<li class="chapter" data-level="15.1" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#fonction-tm_shape"><i class="fa fa-check"></i><b>15.1</b> Fonction <code>tm_shape()</code></a></li>
<li class="chapter" data-level="15.2" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#exemple-de-carte-choroplèthe"><i class="fa fa-check"></i><b>15.2</b> Exemple de carte choroplèthe</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#préparation-des-données-1"><i class="fa fa-check"></i><b>15.2.1</b> Préparation des données</a></li>
<li class="chapter" data-level="15.2.2" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#cartographie"><i class="fa fa-check"></i><b>15.2.2</b> Cartographie</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#exemple-de-carte-à-ronds-proportionnels"><i class="fa fa-check"></i><b>15.3</b> Exemple de carte à ronds proportionnels</a></li>
<li class="chapter" data-level="15.4" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#discretisation"><i class="fa fa-check"></i><b>15.4</b> Discretisation</a></li>
<li class="chapter" data-level="15.5" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#exemples-de-cartes-avec-facet"><i class="fa fa-check"></i><b>15.5</b> Exemples de cartes avec facet</a></li>
<li class="chapter" data-level="15.6" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#gestion-des-palettes"><i class="fa fa-check"></i><b>15.6</b> Gestion des palettes</a></li>
<li class="chapter" data-level="15.7" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#la-mise-en-page"><i class="fa fa-check"></i><b>15.7</b> La mise en page</a></li>
<li class="chapter" data-level="15.8" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#assembler-plusieurs-cartes"><i class="fa fa-check"></i><b>15.8</b> Assembler plusieurs cartes</a></li>
<li class="chapter" data-level="15.9" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#tmap-pour-le-web"><i class="fa fa-check"></i><b>15.9</b> tmap pour le web</a></li>
<li class="chapter" data-level="15.10" data-path="creer-des-cartes-avec-tmap.html"><a href="creer-des-cartes-avec-tmap.html#export-dune-carte"><i class="fa fa-check"></i><b>15.10</b> Export d’une carte</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html"><i class="fa fa-check"></i><b>16</b> Exercices corrigés</a>
<ul>
<li class="chapter" data-level="16.1" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#exercice-1---manipuler-des-objets-sf-1"><i class="fa fa-check"></i><b>16.1</b> Exercice 1 - manipuler des objets sf</a></li>
<li class="chapter" data-level="16.2" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#exercice-2-exploitation-des-données-dvf-en-api-1"><i class="fa fa-check"></i><b>16.2</b> Exercice 2 : exploitation des données DVF en API</a></li>
<li class="chapter" data-level="16.3" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#exercice-3-ggplot-chap-10-visualisation-des-données-dvf-en-api"><i class="fa fa-check"></i><b>16.3</b> Exercice 3 ggplot chap 10 : Visualisation des données DVF en API</a></li>
<li class="chapter" data-level="16.4" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#exercice-4-assemblage-de-cartes-sur-dvf-1"><i class="fa fa-check"></i><b>16.4</b> Exercice 4 : Assemblage de cartes sur dvf</a></li>
<li class="chapter" data-level="16.5" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#exercice-5-cartes-pour-le-web"><i class="fa fa-check"></i><b>16.5</b> Exercice 5 : cartes pour le web</a></li>
<li class="chapter" data-level="16.6" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#exercice-6-exercices-bonus-odd"><i class="fa fa-check"></i><b>16.6</b> Exercice 6 : exercices bonus (ODD)</a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#chargement-des-données-et-datapréparation"><i class="fa fa-check"></i><b>16.6.1</b> Chargement des données et datapréparation</a></li>
<li class="chapter" data-level="16.6.2" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#datavisualisation"><i class="fa fa-check"></i><b>16.6.2</b> Datavisualisation</a></li>
<li class="chapter" data-level="16.6.3" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#carte-monde"><i class="fa fa-check"></i><b>16.6.3</b> Carte monde</a></li>
<li class="chapter" data-level="16.6.4" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#zoom-sur-les-deux-continents"><i class="fa fa-check"></i><b>16.6.4</b> Zoom sur les deux continents</a></li>
<li class="chapter" data-level="16.6.5" data-path="exercices-corrigés.html"><a href="exercices-corrigés.html#assemblage"><i class="fa fa-check"></i><b>16.6.5</b> Assemblage</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://mtes-mct.github.io/parcours-r/">Liste des formations R</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analyses spatiales avec R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lire-des-donnees-spatiales" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapitre 4</span> Lire et écrire des données spatiales avec R<a href="lire-des-donnees-spatiales.html#lire-des-donnees-spatiales" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Dans ce chapitre, nous allons utiliser les packages suivants :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="lire-des-donnees-spatiales.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CRAN</span></span>
<span id="cb3-2"><a href="lire-des-donnees-spatiales.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb3-3"><a href="lire-des-donnees-spatiales.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(remotes)</span>
<span id="cb3-4"><a href="lire-des-donnees-spatiales.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres)</span>
<span id="cb3-5"><a href="lire-des-donnees-spatiales.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb3-6"><a href="lire-des-donnees-spatiales.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spData)</span>
<span id="cb3-7"><a href="lire-des-donnees-spatiales.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-8"><a href="lire-des-donnees-spatiales.html#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="lire-des-donnees-spatiales.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Gitlab-forge</span></span>
<span id="cb3-10"><a href="lire-des-donnees-spatiales.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datalibaba)</span>
<span id="cb3-11"><a href="lire-des-donnees-spatiales.html#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="lire-des-donnees-spatiales.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Github</span></span>
<span id="cb3-13"><a href="lire-des-donnees-spatiales.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(COGiter)</span>
<span id="cb3-14"><a href="lire-des-donnees-spatiales.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CARTElette)</span></code></pre></div>
<p>Le package <code>{sf}</code> s’appuie sur la librairie externe <code>GDAL</code> (Geospatial Data Abstraction Library) pour lire et écrire les données spatiales.
<code>GDAL</code> est une librairie permettant de lire et d’écrire des données vecteur et raster de n’importe quel format de fichier ou base de données.</p>
<p>Les fonctions de lecture et d’écriture de <code>{sf}</code> s’appellent <code>st_read()</code> et <code>st_write()</code>.</p>
<p>Pour lire des données spatiales, <code>st_read()</code> a besoin :</p>
<ul>
<li>d’une source de donnée : un fichier, un répertoire, une base de données ;</li>
<li>d’un layer: une table de données spatiale spécifique du fichier, répertoire, ou de la base de données ;</li>
</ul>
<p>On peut avoir besoin de rajouter des options spécifiques au format de la source.
Par exemple, sur des données en <code>csv</code>, il faut pouvoir spécifier la composante spatiale des données (les champs X, Y ou longitude, latitude).</p>
<div id="lire-des-fichiers-plats" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Lire des fichiers plats<a href="lire-des-donnees-spatiales.html#lire-des-fichiers-plats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>st_read()</code> permet de lire des données spatiales disponibles en fichier plat.</p>
<p>Le format de fichier plat le plus populaire en géomatique est <code>ESRI Shapefile</code>. Ce format, en plus de ne pas être un format ouvert, a des limites bien documentées<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<p>Avec l’avènement du web, le format <code>GeoJSON</code> se développe beaucoup, bien qu’il soit aussi limité.</p>
<p>Le format considéré comme le plus prometteur est le format <code>OGC GeoPackage</code> promu par l’Open Geospatial Consortium<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<p>Mais la liste des formats lisibles par <code>{sf}</code> est bien plus vaste.</p>
<p>Pour l’obtenir, on peut utiliser <code>st_drivers()</code>, qui liste les drivers utilisables par <code>{sf}</code> :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="lire-des-donnees-spatiales.html#cb4-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">st_drivers</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(name))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-100b47682c8f8243c497" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-100b47682c8f8243c497">{"x":{"filter":"none","vertical":false,"data":[["ARCGEN","AVCBin","AVCE00","AeronavFAA","AmigoCloud","BNA","CAD","CSV","CSW","Carto","Cloudant","CouchDB","DGN","DXF","EDIGEO","EEDA","ESRI Shapefile","ESRIJSON","ElasticSearch","GFT","GML","GMLAS","GPKG","GPSBabel","GPSTrackMaker","GPX","GeoJSON","GeoJSONSeq","GeoRSS","Geoconcept","Geomedia","HTF","HTTP","Idrisi","Interlis 1","Interlis 2","JML","JP2OpenJPEG","KML","LIBKML","MBTiles","MSSQLSpatial","MVT","MapInfo File","Memory","MySQL","NAS","NGW","ODBC","ODS","OGR_DODS","OGR_GMT","OGR_OGDI","OGR_PDS","OGR_SDTS","OGR_VRT","OSM","OpenAir","OpenFileGDB","PCIDSK","PDF","PDS4","PGDUMP","PGeo","PLSCENES","PostgreSQL","REC","S57","SEGUKOOA","SEGY","SOSI","SQLite","SUA","SVG","SXF","Selafin","TIGER","TopoJSON","UK .NTF","VDV","VFK","WAsP","WFS","WFS3","Walk","XLS","XLSX","XPlane","netCDF"],["ARCGEN","AVCBin","AVCE00","AeronavFAA","AmigoCloud","BNA","CAD","CSV","CSW","Carto","Cloudant","CouchDB","DGN","DXF","EDIGEO","EEDA","ESRI Shapefile","ESRIJSON","ElasticSearch","GFT","GML","GMLAS","GPKG","GPSBabel","GPSTrackMaker","GPX","GeoJSON","GeoJSONSeq","GeoRSS","Geoconcept","Geomedia","HTF","HTTP","Idrisi","Interlis 1","Interlis 2","JML","JP2OpenJPEG","KML","LIBKML","MBTiles","MSSQLSpatial","MVT","MapInfo File","Memory","MySQL","NAS","NGW","ODBC","ODS","OGR_DODS","OGR_GMT","OGR_OGDI","OGR_PDS","OGR_SDTS","OGR_VRT","OSM","OpenAir","OpenFileGDB","PCIDSK","PDF","PDS4","PGDUMP","PGeo","PLSCENES","PostgreSQL","REC","S57","SEGUKOOA","SEGY","SOSI","SQLite","SUA","SVG","SXF","Selafin","TIGER","TopoJSON","UK .NTF","VDV","VFK","WAsP","WFS","WFS3","Walk","XLS","XLSX","XPlane","netCDF"],["Arc/Info Generate","Arc/Info Binary Coverage","Arc/Info E00 (ASCII) Coverage","Aeronav FAA","AmigoCloud","Atlas BNA","AutoCAD Driver","Comma Separated Value (.csv)","OGC CSW (Catalog  Service for the Web)","Carto","Cloudant / CouchDB","CouchDB / GeoCouch","Microstation DGN","AutoCAD DXF","French EDIGEO exchange format","Earth Engine Data API","ESRI Shapefile","ESRIJSON","Elastic Search","Google Fusion Tables","Geography Markup Language (GML)","Geography Markup Language (GML) driven by application schemas","GeoPackage","GPSBabel","GPSTrackMaker","GPX","GeoJSON","GeoJSON Sequence","GeoRSS","Geoconcept","Geomedia .mdb","Hydrographic Transfer Vector","HTTP Fetching Wrapper","Idrisi Vector (.vct)","Interlis 1","Interlis 2","OpenJUMP JML","JPEG-2000 driver based on OpenJPEG library","Keyhole Markup Language (KML)","Keyhole Markup Language (LIBKML)","MBTiles","Microsoft SQL Server Spatial Database","Mapbox Vector Tiles","MapInfo File","Memory","MySQL","NAS - ALKIS","NextGIS Web","ODBC","Open Document/ LibreOffice / OpenOffice Spreadsheet ","OGR_DODS","GMT ASCII Vectors (.gmt)","OGDI Vectors (VPF, VMAP, DCW)","Planetary Data Systems TABLE","SDTS","VRT - Virtual Datasource","OpenStreetMap XML and PBF","OpenAir","ESRI FileGDB","PCIDSK Database File","Geospatial PDF","NASA Planetary Data System 4","PostgreSQL SQL dump","ESRI Personal GeoDatabase","Planet Labs Scenes API","PostgreSQL/PostGIS","EPIInfo .REC ","IHO S-57 (ENC)","SEG-P1 / UKOOA P1/90","SEG-Y","Norwegian SOSI Standard","SQLite / Spatialite","Tim Newport-Peace's Special Use Airspace Format","Scalable Vector Graphics","Storage and eXchange Format","Selafin","U.S. Census TIGER/Line","TopoJSON","UK .NTF","VDV-451/VDV-452/INTREST Data Format","Czech Cadastral Exchange Data Format","WAsP .map format","OGC WFS (Web Feature Service)","OGC WFS 3 client (Web Feature Service)","Walk","MS Excel format","MS Office Open XML spreadsheet","X-Plane/Flightgear aeronautical data","Network Common Data Format"],[false,false,false,false,true,true,false,true,false,true,true,true,true,true,false,false,true,false,true,true,true,false,true,true,true,true,true,true,true,true,false,false,false,false,true,true,true,false,true,true,true,true,true,true,true,true,false,true,true,true,false,true,false,false,false,false,false,false,false,true,true,true,true,false,false,true,false,true,false,false,false,true,false,false,false,true,true,false,false,true,false,true,false,false,false,false,true,false,true],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,true,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true],[false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,true,false,false,false,false,true,false,false,true,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,true,true,true,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],[true,true,true,true,false,true,true,true,false,false,false,false,true,true,true,false,true,true,false,false,true,true,true,false,true,true,true,true,true,true,false,true,false,true,true,true,true,true,true,true,true,false,true,true,false,false,true,false,false,true,false,true,false,true,true,true,true,true,true,true,true,true,true,false,false,false,false,true,true,true,false,true,true,true,true,true,true,true,true,true,false,true,true,false,false,false,true,true,true]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>long_name<\/th>\n      <th>write<\/th>\n      <th>copy<\/th>\n      <th>is_raster<\/th>\n      <th>is_vector<\/th>\n      <th>vsi<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"name","targets":1},{"name":"long_name","targets":2},{"name":"write","targets":3},{"name":"copy","targets":4},{"name":"is_raster","targets":5},{"name":"is_vector","targets":6},{"name":"vsi","targets":7}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Exemple de lecture d’une donnée au format <code>GeoPackage</code>: les données sur la Leucémie à New York disponibles dans le package <code>spData</code><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="lire-des-donnees-spatiales.html#cb5-1" aria-hidden="true" tabindex="-1"></a>geo_fichier <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;shapes/NY8_bna_utm18.gpkg&quot;</span>, <span class="at">package =</span> <span class="st">&quot;spData&quot;</span>)</span>
<span id="cb5-2"><a href="lire-des-donnees-spatiales.html#cb5-2" aria-hidden="true" tabindex="-1"></a>NY_leukemia <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> geo_fichier)</span></code></pre></div>
</div>
<div id="ecrire-des-fichiers-plats" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Ecrire des fichiers plats<a href="lire-des-donnees-spatiales.html#ecrire-des-fichiers-plats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ecrire des fichiers plats va se faire avec la fonction <code>st_write()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="lire-des-donnees-spatiales.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(<span class="at">obj =</span> NY_leukemia, <span class="at">dsn =</span> <span class="st">&quot;extdata/NY_leukemia.gpkg&quot;</span>)</span></code></pre></div>
<p>Notez que si vous cherchez à exporter une nouvelle fois ce fichier, vous aurez un message d’erreur.</p>
<p>Pour pouvoir écraser ce fichier, vous avez deux options :</p>
<ul>
<li>Utiliser le paramètre <code>layer_option</code> qui vous permet d’inclure des options propres au driver utilisé.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="lire-des-donnees-spatiales.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(</span>
<span id="cb7-2"><a href="lire-des-donnees-spatiales.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj =</span> NY_leukemia,</span>
<span id="cb7-3"><a href="lire-des-donnees-spatiales.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dsn =</span> <span class="st">&quot;extdata/NY_leukemia.gpkg&quot;</span>,</span>
<span id="cb7-4"><a href="lire-des-donnees-spatiales.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">append =</span> <span class="cn">FALSE</span></span>
<span id="cb7-5"><a href="lire-des-donnees-spatiales.html#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li>Utiliser le paramètre <code>delete_layer = TRUE</code> de <code>st_write()</code> qui vous permet d’écraser les layers avant sauvegarde (paramètre qui ne dépend pas du driver utilisé).</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="lire-des-donnees-spatiales.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(</span>
<span id="cb8-2"><a href="lire-des-donnees-spatiales.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj =</span> NY_leukemia,</span>
<span id="cb8-3"><a href="lire-des-donnees-spatiales.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dsn =</span> <span class="st">&quot;extdata/NY_leukemia.gpkg&quot;</span>,</span>
<span id="cb8-4"><a href="lire-des-donnees-spatiales.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">delete_layer =</span> <span class="cn">TRUE</span></span>
<span id="cb8-5"><a href="lire-des-donnees-spatiales.html#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>A noter que <code>st_write()</code> peut exporter des tables géographiques au format csv :</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="lire-des-donnees-spatiales.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(</span>
<span id="cb9-2"><a href="lire-des-donnees-spatiales.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">obj =</span> NY_leukemia,</span>
<span id="cb9-3"><a href="lire-des-donnees-spatiales.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dsn =</span> <span class="st">&quot;extdata/NY_leukemia.csv&quot;</span>,</span>
<span id="cb9-4"><a href="lire-des-donnees-spatiales.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">layer_options =</span> <span class="st">&quot;GEOMETRY=AS_XY&quot;</span>,</span>
<span id="cb9-5"><a href="lire-des-donnees-spatiales.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">delete_layer =</span> <span class="cn">TRUE</span></span>
<span id="cb9-6"><a href="lire-des-donnees-spatiales.html#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Il faut juste lui préciser comment on souhaite écrire la géométrie dans la table exportée, avec
<code>layer_options = "GEOMETRY=AS_WKT"</code> ou <code>layer_options = "GEOMETRY=AS_XY"</code>.</p>
</div>
<div id="lire-des-données-spatiales-du-web" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Lire des données spatiales du web<a href="lire-des-donnees-spatiales.html#lire-des-données-spatiales-du-web" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="lire-des-données-geojson" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Lire des données geojson<a href="lire-des-donnees-spatiales.html#lire-des-données-geojson" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>sf</code> peut lire un geojson qu’il soit hébergé sur un serveur compréssé ou non ou encore disponible par api.</p>
<div id="exemple-1-geojson-classique" class="section level4 hasAnchor" number="4.3.1.1">
<h4><span class="header-section-number">4.3.1.1</span> Exemple 1 (geojson classique):<a href="lire-des-donnees-spatiales.html#exemple-1-geojson-classique" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="lire-des-donnees-spatiales.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_read</span>(<span class="st">&quot;https://france-geojson.gregoiredavid.fr/repo/regions.geojson&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="lire-des-donnees-spatiales.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">&gt;</span> <span class="st">&quot;10&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="lire-des-donnees-spatiales.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="lire-des-donnees-spatiales.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
</div>
<div id="exemple-2-api" class="section level4 hasAnchor" number="4.3.1.2">
<h4><span class="header-section-number">4.3.1.2</span> Exemple 2 (api)<a href="lire-des-donnees-spatiales.html#exemple-2-api" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>L’<a href="https://geo.api.gouv.fr/decoupage-administratif/">api de découpage administratif</a> permet de charger des contours administratifs.
Dans l’exemple suivant, nous chargeons les contours des epci du département 44.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="lire-des-donnees-spatiales.html#cb11-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&#39;https://geo.api.gouv.fr/epcis?codeDepartement=44&amp;format=geojson&amp;geometry=contour&#39;</span></span>
<span id="cb11-2"><a href="lire-des-donnees-spatiales.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_read</span>(url) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="lire-des-donnees-spatiales.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="lire-des-donnees-spatiales.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
</div>
</div>
<div id="exemple-3-geojson-compressé" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Exemple 3 (geojson compressé)<a href="lire-des-donnees-spatiales.html#exemple-3-geojson-compressé" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>sf</code> repose sur <code>GDAL</code> et permet également de lire des geojsons compressés. On pourrait faire de même avec un shapefile compressé en .zip. Cela évite de télécharger le fichier et de le décompresser. Voici un exemple pour récupérer les bâtiments de la commune de Nantes provenant du PCI redistribué par Etalab.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="lire-des-donnees-spatiales.html#cb12-1" aria-hidden="true" tabindex="-1"></a>vfs <span class="ot">&lt;-</span> <span class="st">&#39;/vsigzip//vsicurl/https://cadastre.data.gouv.fr/data/etalab-cadastre/latest/geojson/communes/44/44109/cadastre-44109-batiments.json.gz&#39;</span></span>
<span id="cb12-2"><a href="lire-des-donnees-spatiales.html#cb12-2" aria-hidden="true" tabindex="-1"></a>batiment_nantes <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> vfs) </span></code></pre></div>
<p>Pour aller plus loin sur les <code>Virtual File Systems</code> : <a href="https://gdal.org/user/virtual_file_systems.html">https://gdal.org/user/virtual_file_systems.html</a></p>
</div>
<div id="lire-des-données-wfs" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Lire des données WFS<a href="lire-des-donnees-spatiales.html#lire-des-données-wfs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>sf</code> permet aussi de lire des données WFS.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="lire-des-donnees-spatiales.html#cb13-1" aria-hidden="true" tabindex="-1"></a>crte <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">&#39;https://datacarto.sigloire.fr/wfs?REQUEST=getCapabilities&amp;service=WFS&amp;VERSION=2.0.0&#39;</span>, <span class="at">layer =</span> <span class="st">&quot;ms:r_portrait_crte_r52&quot;</span>)</span>
<span id="cb13-2"><a href="lire-des-donnees-spatiales.html#cb13-2" aria-hidden="true" tabindex="-1"></a>crte <span class="sc">%&gt;%</span> <span class="fu">select</span>(nom_territ) <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code></pre></div>
<p>On indique au niveau du paramètre <code>dsn</code> l’url du webservice WFS de la plateforme et au niveau du parametre <code>layer</code> le nom de la couche.
Pour aller plus loin dans l’exploitation des flux WFS dans R : <a href="https://inbo.github.io/tutorials/tutorials/spatial_wfs_services/" class="uri">https://inbo.github.io/tutorials/tutorials/spatial_wfs_services/</a>.</p>
</div>
</div>
<div id="lireécrire-des-données-spatiales-sur-postgis" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Lire/écrire des données spatiales sur PostGIS<a href="lire-des-donnees-spatiales.html#lireécrire-des-données-spatiales-sur-postgis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>PostGIS</code>, c’est l’extension géomatique de <code>PostgreSQL</code> permettant de stocker des données géo sur un serveur de données et de les manipuler.</p>
<p>R vous permet de vous connecter simplement à une base PostGIS.
Pour cela vous aurez besoin du package <code>{DBI}</code> (package permettant de s’interfacer à des bases de données) et du package <code>{RPostgres}</code> (interface à PostgreSQL en particulier).</p>
<p>Rstudio a développé tout un site sur les interactions entre les bases de données et R, vous pouvez le trouver à l’adresse suivante : <a href="https://db.rstudio.com/">db.rstudio.com</a>.</p>
<p>Rstudio possède même depuis la version 1.1 un onglet de connexion vous permettant de visualiser vos connexions aux bases.</p>
<p>Pour se connecter à une base, il faut définir un driver (à quelle type de base on veut se connecter et selon quel protocole) et un connecteur (les informations de connexion).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="lire-des-donnees-spatiales.html#cb14-1" aria-hidden="true" tabindex="-1"></a>drv <span class="ot">&lt;-</span> <span class="fu">dbDriver</span>(<span class="st">&quot;Postgres&quot;</span>)</span>
<span id="cb14-2"><a href="lire-des-donnees-spatiales.html#cb14-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(drv,</span>
<span id="cb14-3"><a href="lire-des-donnees-spatiales.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbname =</span> <span class="st">&quot;nom_de_ma_db&quot;</span>,</span>
<span id="cb14-4"><a href="lire-des-donnees-spatiales.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">host =</span> <span class="st">&quot;adresse_ip_du_serveur&quot;</span>,</span>
<span id="cb14-5"><a href="lire-des-donnees-spatiales.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">port =</span> numero_du_port,</span>
<span id="cb14-6"><a href="lire-des-donnees-spatiales.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">user =</span> <span class="st">&quot;nom_utilisateur&quot;</span>,</span>
<span id="cb14-7"><a href="lire-des-donnees-spatiales.html#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">password =</span> <span class="st">&quot;mot_de_passe_super_secret&quot;</span></span>
<span id="cb14-8"><a href="lire-des-donnees-spatiales.html#cb14-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Pour lire des données sur le serveur, on va utiliser encore la fonction <code>st_read()</code> en lui définissant 2 paramètres : le connecteur et la requête que l’on veut réaliser.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="lire-des-donnees-spatiales.html#cb15-1" aria-hidden="true" tabindex="-1"></a>ma_table <span class="ot">&lt;-</span> <span class="fu">st_read</span>(con, <span class="at">query =</span> <span class="st">&quot;SELECT * FROM le_schema.ma_table&quot;</span>)</span></code></pre></div>
<p>L’avantage ici est que vous pouvez faire travailler le serveur directement sans avoir à faire travailler votre poste de travail.</p>
<p>Vous pouvez très bien, dans cette requête sql, réaliser quelques filtres, sélections et agrégations.
Celles-ci seront alors réalisées par le serveur posgreSQL et non par votre session R qui ne récupérera que le résultat.</p>
<p>Vous pouvez écrire vos données ensuite de la même façon avec <code>st_write()</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="lire-des-donnees-spatiales.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ma_table,</span>
<span id="cb16-2"><a href="lire-des-donnees-spatiales.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dsn =</span> con,</span>
<span id="cb16-3"><a href="lire-des-donnees-spatiales.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">layer =</span> <span class="fu">Id</span>(<span class="at">schema =</span> <span class="st">&quot;schema&quot;</span>, <span class="at">table =</span> <span class="st">&quot;ma_table&quot;</span>)</span>
<span id="cb16-4"><a href="lire-des-donnees-spatiales.html#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Un package, encore expérimental, de la DREAL Pays de la Loire, <a href="https://dreal-datalab.gitlab.io/datalibaba/index.htmlhttps://dreal-pdl.gitlab-pages.din.developpement-durable.gouv.fr/csd/datalibaba/index.html">{datalibaba}</a> simplifie l’écriture des instructions de lecture/écriture de données vers ou depuis un SGBD Postgresql/postgis.</p>
<p>Il propose de stocker vos identifiants de connexion dans vos variables d’environnement, c’est à dire en dehors de votre script, afin d’en préserver la confidentialité, mais aussi de vous éviter de les réécrire dans chaque script.</p>
<p>L’utilisateur n’a plus à se préoccuper du driver de connexion ni de la fonction de lecture ou de comment placer le nom du schéma par rapport au nom de la table.</p>
<p>Les types propres à R, comme les facteurs, sont préservés au ré-import.</p>
<p>Les instruction précédentes deviennent :</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="lire-des-donnees-spatiales.html#cb17-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_gitlab</span>(<span class="st">&#39;dreal-pdl/csd/datalibaba&#39;</span>, <span class="at">host =</span> <span class="st">&quot;gitlab-forge.din.developpement-durable.gouv.fr&quot;</span>)</span>
<span id="cb17-2"><a href="lire-des-donnees-spatiales.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(datalibaba)</span>
<span id="cb17-3"><a href="lire-des-donnees-spatiales.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="lire-des-donnees-spatiales.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">poster_data</span>(<span class="at">data =</span> regions_geo, <span class="at">schema =</span> <span class="st">&quot;admin_express&quot;</span>, <span class="at">table =</span> <span class="st">&quot;n_regions&quot;</span>, <span class="at">pk =</span> <span class="st">&#39;REG&#39;</span>, <span class="at">db =</span> <span class="st">&#39;referentiels&#39;</span>)</span>
<span id="cb17-5"><a href="lire-des-donnees-spatiales.html#cb17-5" aria-hidden="true" tabindex="-1"></a>station <span class="ot">&lt;-</span> <span class="fu">importer_data</span>(<span class="at">table =</span> <span class="st">&quot;station&quot;</span>, <span class="at">schema =</span> <span class="st">&quot;pesticides&quot;</span>, <span class="at">base =</span> <span class="st">&quot;production&quot;</span>)</span></code></pre></div>
<p>Pour tester ces fonctions, le SSP Cloud permet de lancer des instances de postgresql/postgis et de les interoger depuis une session RStudio.</p>
</div>
<div id="convertir-un-dataframe" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Convertir un dataframe<a href="lire-des-donnees-spatiales.html#convertir-un-dataframe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Une autre façon d’obtenir un <em>spatial dataframe</em> est de convertir un objet existant en objet sf. Par exemple, partir d’un dataframe sur lequel on va définir à la fois la ou les colonnes contenant la dimension géographique et le crs de référence. Ou encore convertir un objet de type <code>sp</code> en objet de type <code>sf</code>.</p>
<p>Pour cela, la fonction <code>st_as_sf()</code> permet de convertir un objet en objet <code>sf</code> en définissant la composante spatiale.</p>
<p>La fonction <code>st_set_crs()</code> permet de définir le crs de notre objet.</p>
<p>Exemple, nous allons lire les coordonnées géographiques des préfectures de région.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="lire-des-donnees-spatiales.html#cb18-1" aria-hidden="true" tabindex="-1"></a>prefectures <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">&quot;extdata/prefecture.csv&quot;</span>)</span>
<span id="cb18-2"><a href="lire-des-donnees-spatiales.html#cb18-2" aria-hidden="true" tabindex="-1"></a>prefectures_geo <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(prefectures, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="at">crs =</span> <span class="dv">2154</span>) </span></code></pre></div>
</div>
<div id="données-contenues-dans-des-packages" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Données contenues dans des packages<a href="lire-des-donnees-spatiales.html#données-contenues-dans-des-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Depuis le développement de <code>{sf}</code>, de nombreux packages proposent des données géographiques.</p>
<p>Pour la France, les packages <code>{CARTElette}</code> et <code>{COGiter}</code> propose des fonds de cartes aux contours administratifs.</p>
<p>Ils s’installent depuis github :</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="lire-des-donnees-spatiales.html#cb19-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;MaelTheuliere/COGiter&quot;</span>)</span>
<span id="cb19-2"><a href="lire-des-donnees-spatiales.html#cb19-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;antuki/CARTElette/CARTElette@RPackage&quot;</span>)</span></code></pre></div>
<p><code>{CARTElette}</code> propose de télécharger les différents fonds de plan administratifs d’admin-Express COG de l’IGN, de tous les millésimes jusque 2021.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="lire-des-donnees-spatiales.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">charger_carte</span>(<span class="at">COG =</span> <span class="dv">2021</span>, <span class="at">nivsupra =</span> <span class="st">&quot;REG&quot;</span>, <span class="at">geometrie_simplifiee =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="lire-des-donnees-spatiales.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="lire-des-donnees-spatiales.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<pre><code>Reading layer `REG_2021_CARTElette&#39; from data source 
  `/tmp/RtmpwytDxM/REG_2021_CARTElette.shp&#39; using driver `ESRI Shapefile&#39;
Simple feature collection with 18 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -5.141241 ymin: 40.26843 xmax: 9.560094 ymax: 51.08899
Geodetic CRS:  WGS 84</code></pre>
<p><img src="support_m7_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p><code>{COGiter}</code> contient le dernier millésime des fonds de plan administratifs.
Ces couches sont obtenues par simplification des couches admin-express COG de l’IGN et sont adaptées à la visualisation d’indicateurs statistiques.</p>
<p>Il comprend pour la métropole et chaque DROM un fond de carte pour les niveaux communes, EPCI, départements, régions :</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="lire-des-donnees-spatiales.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(<span class="st">&quot;package:COGiter&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;_geo$&quot;</span>)</span></code></pre></div>
<pre><code> [1] &quot;communes_971_geo&quot;       &quot;communes_972_geo&quot;       &quot;communes_973_geo&quot;      
 [4] &quot;communes_974_geo&quot;       &quot;communes_976_geo&quot;       &quot;communes_geo&quot;          
 [7] &quot;communes_metro_geo&quot;     &quot;departements_971_geo&quot;   &quot;departements_972_geo&quot;  
[10] &quot;departements_973_geo&quot;   &quot;departements_974_geo&quot;   &quot;departements_976_geo&quot;  
[13] &quot;departements_geo&quot;       &quot;departements_metro_geo&quot; &quot;epci_971_geo&quot;          
[16] &quot;epci_972_geo&quot;           &quot;epci_973_geo&quot;           &quot;epci_974_geo&quot;          
[19] &quot;epci_976_geo&quot;           &quot;epci_geo&quot;               &quot;epci_metro_geo&quot;        
[22] &quot;filtrer_cog_geo&quot;        &quot;regions_971_geo&quot;        &quot;regions_972_geo&quot;       
[25] &quot;regions_973_geo&quot;        &quot;regions_974_geo&quot;        &quot;regions_976_geo&quot;       
[28] &quot;regions_geo&quot;            &quot;regions_metro_geo&quot;     </code></pre>
<p>La fonction <code>filtrer_cog_geo()</code> vous permet d’obtenir une liste de spatial dataframes des différentes échelles, centrée sur une partie du territoire (que ce soit une commune, un EPCI, un département ou une région) dès lors que vous connaissez son code officiel.</p>
<p>Exemple sur la Normandie :</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="lire-des-donnees-spatiales.html#cb24-1" aria-hidden="true" tabindex="-1"></a>normandie <span class="ot">&lt;-</span> <span class="fu">filtrer_cog_geo</span>(<span class="at">reg =</span> <span class="st">&quot;28&quot;</span>)</span>
<span id="cb24-2"><a href="lire-des-donnees-spatiales.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(normandie)</span></code></pre></div>
<pre><code>List of 4
 $ communes    : sf [2,651 × 3] (S3: sf/tbl_df/tbl/data.frame)
  ..$ DEPCOM  : chr [1:2651] &quot;50272&quot; &quot;76515&quot; &quot;14293&quot; &quot;27021&quot; ...
  ..$ AREA    : num [1:2651] 17596289 3390000 6701110 8186754 5573846 ...
  ..$ geometry:sfc_MULTIPOLYGON of length 2651; first list element: List of 1
  .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;
  ..- attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
  ..- attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA
  .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;DEPCOM&quot; &quot;AREA&quot;
 $ epci        : sf [71 × 3] (S3: sf/tbl_df/tbl/data.frame)
  ..$ EPCI    : Factor w/ 1256 levels &quot;200000172&quot;,&quot;200000438&quot;,..: 18 38 95 96 113 118 157 226 231 244 ...
  ..$ AREA    : Units: [m^2] num [1:71] 5.76e+08 6.64e+08 2.82e+08 3.66e+08 5.73e+08 ...
  ..$ geometry:sfc_POLYGON of length 71; first list element: List of 1
  .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;POLYGON&quot; &quot;sfg&quot;
  ..- attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
  ..- attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA
  .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;EPCI&quot; &quot;AREA&quot;
 $ departements: sf [5 × 3] (S3: sf/tbl_df/tbl/data.frame)
  ..$ DEP     : Factor w/ 101 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 14 26 51 62 77
  ..$ AREA    : Units: [m^2] num [1:5] 5.59e+09 6.04e+09 6.02e+09 6.14e+09 6.32e+09
  ..$ geometry:sfc_POLYGON of length 5; first list element: List of 1
  .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;POLYGON&quot; &quot;sfg&quot;
  ..- attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
  ..- attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA
  .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;DEP&quot; &quot;AREA&quot;
 $ regions     : sf [1 × 3] (S3: sf/tbl_df/tbl/data.frame)
  ..$ REG     : Factor w/ 18 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 9
  ..$ AREA    : Units: [m^2] num 3.01e+10
  ..$ geometry:sfc_POLYGON of length 1; first list element: List of 1
  .. ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;POLYGON&quot; &quot;sfg&quot;
  ..- attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
  ..- attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA
  .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;REG&quot; &quot;AREA&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="lire-des-donnees-spatiales.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(normandie<span class="sc">$</span>epci)</span></code></pre></div>
<p><img src="support_m7_files/figure-html/COGiter-1.png" width="672" /></p>
<p>Le package COGiter propose également :</p>
<ul>
<li>les tables du COG 2022 de l’Insee,</li>
<li>une table de passage des COG historiques vers le COG millésimé 2022,</li>
<li>des fonctions d’aide à au passage de jeux de données vers le millésime du COG 2022,<br />
</li>
<li>des fonctions de calculs d’agrégats aux différentes échelles territoriales,<br />
</li>
<li>des fonctions d’aide à la sélection des différents fond de cartes nécessaire à la mise en page de cartes statistiques.</li>
</ul>
<p>Son utilisation est désormais <a href="https://mtes-mct.github.io/parcours_r_socle_preparation_des_donnees/nettoyer-des-donn%C3%A9es-territoriales-g%C3%A9rer-les-%C3%A9volutions-du-cog-code-officiel-g%C3%A9ographique.html">vue lors du module 2</a>.</p>

</div>
</div>



<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>voir <a href="http://switchfromshapefile.org/" class="uri">http://switchfromshapefile.org/</a><a href="lire-des-donnees-spatiales.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p><a href="https://www.geopackage.org/" class="uri">https://www.geopackage.org/</a><a href="lire-des-donnees-spatiales.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Issues de Waller and Gotway (2004) Applied Spatial Statistics for Public Health Data.<a href="lire-des-donnees-spatiales.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="crs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="operation-sur-donnees-attributaires.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"pandoc_args": ["-M", "toc-title=Table des matières"]
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
